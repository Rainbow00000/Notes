# 程序化随机地牢生成1

原文地址：https://github.com/adnzzzzZ/blog/issues/1

这篇文章简要地介绍了一种使用代码生成随机地牢的技术，该技术一定程度基于下图展示的技术：

![](https://pic1.zhimg.com/80/v2-20f27d522af196a029ee38c3bacfbbe8_1440w.jpg)

## 1. 网格生成

生成一个网格图，其中每一个方块我们称为一个网格：

![](https://pic3.zhimg.com/80/v2-60d82f67842f580bfae63257f5d6517e_1440w.jpg)

## 2. 网格难度着色
将其中x个网格涂成红色（表示困难），y个网格涂成蓝色（表示中等），z个网格涂成绿色（表示简单），使 x+y+z=n，n为网格的数量，x，y和z用来控制难度

首先，将x个网格涂成红色，保证没有红色网格相邻
然后，对于每一个红色网格，将其相邻的一个网格涂成蓝色，另一个相邻的网格涂成绿色
最后，用每种颜色剩余的数量将剩余网格随机上色

![](https://pic4.zhimg.com/80/v2-e308f2ec82f7c15c449c3e7f40b2b3a7_1440w.jpg)

## 3. 创建地牢路径
选择两个相距足够远的网格节点，在它们之间开辟一条路径，同时尽可能避开红色房间。

如果你选择了一个适当的x值，由于红色网格之间不能相邻，并且寻路算法也不适合对角线，因此两个网格节点间将创建一条不太直接的路径

![](https://pic3.zhimg.com/80/v2-79adc86965ed5771ab07f57d0dec4476_1440w.jpg)

对于路径中的所有网格节点，添加与其相邻的红色、蓝色或绿色相邻网格节点，这应该会增加地牢中可行路径和整体复杂性（难度）的可能性

![](https://pic1.zhimg.com/80/v2-6c10cdca0cc85ac42de1940494323fa4_1440w.jpg)

## 4. 房间的创建与连接
根据预期的房间大小将较小的网格节点合并为较大的网格。保证较高的机率使用较小的宽度/高度，较低的机率使用较大的宽度/高度

![](https://pic2.zhimg.com/80/v2-dbbcb7a5b42b30c37174ae0432e8bd31_1440w.jpg)

生成房间之间的所有可能的连接

![](https://pic2.zhimg.com/80/v2-e8363e487384e328179fc67f442efb1d_1440w.jpg)

随机删除连接，直到满足每个房间一定数量的连接。

如果 n =总房间数量，则将 n * a 个房间的连接数设置为> = 4，n * b 个房间的连接数设置为3，n * c 个房间的连接数设置为 2，n * d 个房间的连接数设置为 1，使得 a + b + c + d = 1

控制 a，b，c和d 可让你控制地牢的复杂程度。 如果 c 或 d 远大于 a 或 b，那么将不会有许多错综复杂的路径，它将会有很多死胡同。 如果 a 或b 更高，则地牢将四通八达，因此也更容易

![](https://pic4.zhimg.com/80/v2-5140c565558b32de488423ba5cac841b_1440w.jpg)

重新连接孤立的房间。由于最后一步是完全随机的，因此有的房间很有可能无法到达

![](https://pic2.zhimg.com/80/v2-b9085ccf6cd1d2934871aa1b8a8c9de9_1440w.jpg)

为了解决这个问题：

1. 找出存在多少个孤立的房间组（很多种算法）
2. 随机选择一个房间组，遍历其中的每一个房间，检查是否与其他房间组里的房间相邻，如果相邻，则连接它们
3. 重复前面的步骤，直到只剩下一个房间组（所有房间组都已连接）

![](https://pic4.zhimg.com/80/v2-593bff273df91043f82ae3f5be8365df_1440w.jpg)

## 5. 结束语
基本思路就是这样。不过还有更多东西可以扩充，例如：添加特殊房间、将其中一些房间设置成隐藏房间等。

基本上，我在创建新的地下城时会控制一些参数：地下城的宽度/高度； 困难，中等和简单房间的百分比；将哪种颜色的邻居添加到原始路径，以及具有 > = 4、3、2或1个连接的房间的百分比， 我认为通过这些参数足以控制地牢的难度/难度