# Lua注意事项

- 在条件检测中Lua语言把**零**和**空字符串**也都视为真。

- 在少数情况下，当需要区分**整型值**和**浮点型值**时，可以使用函数`math.type`：

  ```lua
  math.type(3) --> integer
  math.type(3.0) --> float
  ```

- 通过与零进行按位或运算，可以把浮点型值强制转换为整型值

  ```lua
  2^53 --> 9.007199254741e+15
  2^53 | 0 --> 9007199254740992
  ```

- 函数`reverse`、`upper`、`lower`、`byte`和`char`不适用于UTF-8字符串，这是因为它们针对的都是一字节字符

- 唯一的例外就是，当函数只有一个参数且该参数是字符串常量或表构造器时，括号是可选的

  ```lua
  print "Hello World"    <-->  print("Hello World")
  dofile 'a.lua'         <-->  dofile('a.lua')
  print [[ a multi-line  <-->  print([[ a multi-line
   message ]]                   message ]])
  f{x=10, y=20}          <-->  f({x=10, y=20})
  type{}                 <-->  type({})
  ```
  
- 函数`io.write`可以读取任意数量的字符串（或者数字）并将其写入当前输出流。由于调用该函数时可以使用多个参数，因此应该避免使用`io.write(a..b..c)`，应该调用`io.write(a,b,c)`，后者可以用更少的资源达到同样的效果，并且可以避免更多的连接动作

- 调用函数`file:seek()`会返回当前的位置且不改变当前位置；调用函数`file:seek("set")`会将位置重置到文件开头并返回0；调用函数`file:seek("end")`会将当前位置重置到文件结尾并返回文件的大小

  ```lua
  function fsize(file)
    local current = file:seek()
    local size = file:seek("end")
    file:seek("set", current)
    return size
  end
  ```
  
- 函数`os.renam`e用于文件重命名，函数`os.remove`用于移除（删除）文件。需要注意的是，由于这两个函数处理的是真实文件而非流，所以它们位于os库而非io库中

- 和大多数其他编程语言不同，在Lua语言中，循环体内声明的局部变量的作用域包括测试条件

- 按照语法，return只能是代码块中的最后一句：换句话说，它只能是代码块的最后一句，或者是end、else和until之前的最后一句

- 在使用goto跳转时，Lua语言设置了一些限制条件。首先，标签遵循常见的可见性规则，因此不能直接跳转到一个代码块中的标签（因为代码块中的标签对外不可见）。其次，goto不能跳转到函数外（注意第一条规则已经排除了跳转进一个函数的可能性）。最后，goto不能跳转到局部变量的作用域

- 在模式匹配中，所有预置的字符分类及其对应的含义:

  |写法|含义|
  |:---|:---|
  |.|任意字符|
  |%a|字母|
  |%c|控制字符|
  |%d|数字|
  |%g|处空格外的可打印字符|
  |%l|小写字母|
  |%p|标点符号|
  |%s|空白字符|
  |%u|大写字母|
  |%w|字母和数字|
  |%x|十六进制数字|

  这些类的大写形式表示类的补集。例如，'%A'代表任意非字母的字符

- 在模式匹配中，魔法字符包括：

  `( ) . % + - * ? [ ] ^ $`

  百分号同样可以用于这些魔法字符的转义。因此，'%？'匹配一个问号，'%%'匹配一个百分号

